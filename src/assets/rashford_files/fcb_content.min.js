"use strict";PULSE.app.templates["barca-today-items"]=_.template('<li class="barca-today__item js-thumb"> <% if (isContent) { %> <a href="<%= url %>" class="content-today content-today--link content-today--<%= contentType %>"> <% } else { %> <div class="content-today content-today--<%= contentType %>"> <% } %> <picture class="content-today__picture js-lazy-picture"> <% if (typeof photo === \'string\') { %> <img src="" data-image-src="<%= photo %>" alt="<%= contentType + \' photo\' %>" class="content-today__photo"> <% } else {\n                var variants = IMAGE_HELPER.getVariantsForContentType(photo);\n                if ( variants ) {\n                    var imageUrl = IMAGE_HELPER.getPhotoByVariant( variants, \'Standard Article Hero - Mobile\' );\n                    var imageUrlRetina = IMAGE_HELPER.getPhotoByVariant( variants, \'Standard Article Hero - Mobile\' );\n\n                    if ( imageUrl && imageUrlRetina ) { %> <source srcset="" data-image-src="<%= imageUrl.url %>, <%= imageUrlRetina.url %> 2x"> <img src="" data-image-src="<%= imageUrl.url %>" alt="<%= photo.title || \'\' %>" class="content-today__photo"> <% }\n                }\n            } %> </picture> <% if (isContent) { %> <div class="content-today__content-type"> <svg class="content-today__type-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/resources/<%= window.RESOURCE_VERSION %>/i/svg-output/icn.svg#<%= contentType %>"></use></svg> <span class="visually-hidden"><%= contentType %></span> <span class="content-today__type"><%= PULSE.I18N.lookup(\'label.\' + contentType) %></span> </div> <% } else { %> <a href="<%= content.link %>" class="content-today__content-type content-today__content-type--link" target="_blank" rel="noopener"> <svg class="content-today__type-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/resources/<%= window.RESOURCE_VERSION %>/i/svg-output/icn.svg#<%= contentType %>"></use></svg> <span class="visually-hidden"><%= contentType %></span> <span class="content-today__type"><%= content.atChar + content.user.account %></span> </a> <% } %> <div class="content-today__content"> <span class="content-today__title"><%= content.title || content.text || \'\' %></span> </div> <% if (isContent) { %> </div></a> <% } else { %>  <% } %> </li>'),PULSE.app.templates["news-feed-container"]=_.template('<div class="feed__container js-feed-container"> <div class="branding-bar"></div> <div class="feed__date"> <div class="feed__day"><%= date.format(\'dddd\') %></div> <% var dateFormat = PULSE.app.language === \'ja\' ? \'MMMDæ—¥\' : \'MMMM DD\'; %> <div class="feed__month"><%= date.format(dateFormat) %></div> </div> <div class="feed__items js-feed-items"></div> </div>'),PULSE.app.templates["news-feed-empty"]=_.template("<%= PULSE.I18N.lookup( 'label.sorrynocontent' ) %>"),function(t,e){const n=function(){const t=this,e={contentTypes:"TEXT,VIDEO,PLAYLIST",limit:t.maxLimit,tagExpression:`"${CONSTANTS.TAGS.TYPE.NEWS.tag}" or "${CONSTANTS.TAGS.TYPE.GALLERY.tag}" or "${CONSTANTS.TAGS.TYPE.VIDEO.tag}"`},n=axios.get(URL_HELPER.getMultiContentUrl(e)),o=axios.get(URL_HELPER.getSocialStreamUrl(t.streamId,t.maxLimit));Promise.all([n,o]).then(([e,n])=>{const o=a(n.data.content),l=e.data.content.concat(o).sort((t,e)=>e.publishFrom-t.publishFrom);i.call(t,l.slice(0,t.maxLimit))})},o=function(t){if(t.photo)return t.photo;switch(t.type){case"text":return t.leadMedia;case"video":return t.thumbnail;case"playlist":return t.coverItem;default:return""}},a=function(t){return t.map(t=>SOCIAL_HELPER.getSocialModel(t)).filter(t=>t.photo.length>0)},i=function(e){const n=this;if(0===e.length)return;let a="";e.forEach(t=>{const e=function(t){if(t.feedType)return t.feedType;switch(t.type){case"text":return"news";case"video":return"video";case"playlist":return"gallery";default:return""}}(t),i="video"===e||"news"===e||"gallery"===e;let l="";if(i){const o="text"===e?n.isFeatured()?"featured":null:t.typeRestriction;l=URL_HELPER.generateUrl(e,t.id,o,t.title,"https",t.tags)}a+=TEMPLATE_HELPER.render({content:t,contentType:e,isContent:i,photo:o(t),url:l},"barca-today-items")}),n.contentContainer.innerHTML=a;const i=n.contentContainer.querySelectorAll(`.${CONSTANTS.JS_CLS_NAMES.LAZY_PICTURE_ELEMENT}`);for(let e=0;e<i.length;e++)new t.common.LazyPictureElement(i[e]);new t.ContentSlider(n.container)};t.BarcaToday=function(t){const o=this;o.container=t,o.contentContainer=o.container.querySelector(".js-barca-today-content"),o.maxLimit=Number(o.container.getAttribute("data-maxitems")||20),o.streamId=o.container.getAttribute("data-stream-id"),o.container.addEventListener(CONSTANTS.EVENT.ACTIVATE,n.bind(o)),e.GlobalIntersectionObserver.observe(o.container)};const l=document.querySelectorAll('[data-widget="barca-today"]');for(let e=0;e<l.length;e++)new t.BarcaToday(l[e])}(PULSE.app,PULSE.app.common),function(t,e,n){const o="is-active";t.CarouselHero=function(e){const n=this;n.container=e,n.tiles=[].slice.call(n.container.querySelectorAll(".js-hero-tile")),n.setListeners();const o=n.container.querySelectorAll(`.${CONSTANTS.JS_CLS_NAMES.LAZY_PICTURE_ELEMENT}`);for(let e=0;e<o.length;e++)new t.common.LazyPictureElement(o[e])},t.CarouselHero.prototype.setActive=function(t){this.tiles.forEach(t=>{n.style.removeClass(t,o)}),n.style.addClass(t.currentTarget,o)},t.CarouselHero.prototype.setListeners=function(){const t=this;for(let e=0;e<t.tiles.length;e++)t.tiles[e].addEventListener("mouseover",e=>t.setActive(e)),t.tiles[e].addEventListener("focusin",e=>t.setActive(e)),n.style.removeClass(t.tiles[e],"hero-tile--disabled")};const a=document.querySelectorAll('[data-widget="content-hero"]');for(let e=0;e<a.length;e++)new t.CarouselHero(a[e],{})}(PULSE.app,PULSE.app.common,PULSE.core),function(t,e,n){const o="feed--is-empty",a=function(t){switch(t.type){case"playlist":return"content-gallery-item";case"text":return"content-article-item";default:return""}},i=function(){const t=this;t.listContainer=null,t.showMoreElement=null,t.filterContainer=null,t.showMoreCheck=!1,t.fetchData=!1,t.pageLimit=CONSTANTS.CONTENT_API.DEFAULT_PAGE_SIZE,t.defaultTags=null,t.type=null,t.references=null,t.filter=null,t.columnClass=null,t.gridWidth=null,t.thumbnailClass=null,t.ignoreContent=null,t.additionalConfigClass=null},l=function(t){const e=this;e.listContainer=t.querySelector("[data-content-list]")||e.listContainer,e.showMoreElement=t.querySelector(`.${CONSTANTS.JS_CLS_NAMES.SHOW_MORE}`)||e.showMoreElement,e.filterContainer=t.querySelector("[data-content-filter]")||e.filterContainer,e.showMoreCheck="true"===t.getAttribute("data-show-more")||e.showMoreCheck,e.fetchData="true"===t.getAttribute("data-fetch")||e.fetchData,e.pageLimit=Number(t.getAttribute("data-page-size"))||e.pageLimit,e.defaultTags=t.getAttribute("data-tags")||e.defaultTags,e.type=t.getAttribute("data-type")||e.type,e.references=t.getAttribute("data-references")||e.references,e.filter=t.getAttribute("data-filter")||e.filter,e.gridWidth=t.getAttribute("data-grid-width")||e.gridWidth,e.columnClass=t.getAttribute("data-column-class")||e.columnClass,e.thumbnailClass=t.getAttribute("data-thumbnail-class")||e.thumbnailClass,e.ignoreContent=(t.getAttribute("data-ignore")||"").split(",")||e.ignoreContent,e.additionalConfigClass=t.getAttribute("data-additional-config")||e.additionalConfigClass,e.config.hideIfNoResults=t.getAttribute("data-hide-if-no-results")||e.config.hideIfNoResults||!1,e.pagination={offset:0,limit:e.pageLimit}},r=function(){const t=this;if(!t.additionalConfigClass)return;const e=document.querySelector(t.additionalConfigClass);e&&l.call(t,e)},s=function(){this.getContentData(!1)};t.ContentList=function(t,n){const o=this;o.element=t,o.config=n||{},i.call(o),l.call(o,o.element),r.call(o);let a={offset:0,limit:parseInt(o.pageLimit),tagNames:o.defaultTags};o.type&&(a.contentTypes=CONSTANTS.CONTENT_API.MIXED_CONTENT_TYPES),o.listFilter=new e.FilterOptions(a),o.filter&&(o.filterContainer=new e.FilterOptions(o,o.filterContainer)),function(t){switch(t.type){case"gallery-list":t.listFilter.updateFilters({playlistTypeRestriction:"photo"});break;case"news-feed":case"news-list":t.thumbnailClass="thumbnail--wide",t.template="content-news-feed-item";break;case"mixed-content":t.columnClass="col-3 col-6-desk col-12-phab"}}(o),o.showMoreCheck&&(o.showMore=new e.ShowMore(o.showMoreElement,{callback:s.bind(o)})),o.fetchData&&o.getContentData(!0)},t.ContentList.prototype.getContentData=function(e){const o=this;e?o.listFilter.updateFilters({offset:0}):o.listFilter.updateFilters({offset:o.listFilter.get().offset+o.pageLimit});let a="";switch(o.type){case"gallery-list":a=t.apiPath.cms.playlist+"?"+n.url.buildQueryString(o.listFilter.get());break;case"news-feed":case"news-list":a=t.apiPath.cms.text+"?"+n.url.buildQueryString(o.listFilter.get());break;case"mixed-content":a=t.apiPath.cms.general+"?"+n.url.buildQueryString(o.listFilter.get())}const i={url:a,callback:t=>{o.render(t,e)},forceCallback:!0,target:o};n.data.manager.add(i)},t.ContentList.prototype.update=function(t){const e=this;if("FORMAT"===t.type)"ALL"===t.key?e.listFilter.updateFilters({tagNames:e.defaultTags}):e.listFilter.updateFilters({tagNames:t.key});e.page=0,e.listFilter.updateFilters({page:0}),e.getContentData(!0)},t.ContentList.prototype.isEmpty=function(){return n.style.hasClass(this.listContainer,o)},t.ContentList.prototype.render=function(i,l){const r=this;let s={items:[]};void 0!==i.content&&i.content.length>0&&(s.items=i.content.map(function(t){return new e.ContentModel(t,{gridWidth:r.gridWidth,columnClass:r.columnClass,thumbnailClass:r.thumbnailClass,template:r.template||a(t)})}),n.style.removeClass(r.listContainer,o)),r.showMore&&0===s.items.length?r.showMore.hide():(l&&(r.listContainer.innerHTML="",0===i.content.length&&(n.style.addClass(r.listContainer,o),r.listContainer.innerHTML=TEMPLATE_HELPER.render({},"news-feed-empty"))),s.items.forEach(function(t){r.ignoreContent.includes(t.data.id.toString())||r.listContainer.appendChild(t.element)}),r.config.hideIfNoResults&&0===r.listContainer.children.length?n.style.addClass(r.element,CONSTANTS.STYLE_CLS_NAMES.HIDE):n.style.removeClass(r.element,CONSTANTS.STYLE_CLS_NAMES.HIDE),r.showMore&&r.showMore.setPagination(r.pagination),t.common.articleModal&&t.common.articleModal.modal.addThumbListeners(r.listContainer.querySelectorAll(`.${CONSTANTS.JS_CLS_NAMES.ARTICLE_MODAL_EXPAND_THUMB}`)),"function"==typeof r.config.onRenderCallback&&r.config.onRenderCallback(s))};const c=document.querySelectorAll('[data-widget="content-list"]');for(let e=0;e<c.length;e++)new t.ContentList(c[e],{})}(PULSE.app,PULSE.app.common,PULSE.core),function(t){const e=document.querySelectorAll('[data-widget="content-trending"]');for(let n=0;n<e.length;n++)new t.ContentSlider(e[n])}(PULSE.app),function(t,e,n){const o=function(){const t=this;t.container.addEventListener(CONSTANTS.EVENT.ACTIVATE,()=>{n.style.addClass(t.container,`gallery-featured-widget${CONSTANTS.STYLE_CLS_MODIFIERS.ACTIVE}`)})};t.FeaturedContentWidget=function(t){const n=this;n.container=t,o.call(n),e.GlobalIntersectionObserver.observe(n.container)};const a=document.querySelectorAll('[data-widget="featured-content-widget"]');for(let e=0;e<a.length;e++)new t.FeaturedContentWidget(a[e],{})}(PULSE.app,PULSE.app.common,PULSE.core,CONSTANTS),function(t,e){t.GalleryAlbum=function(t){new e.GalleryAlbum(t)};const n=document.querySelectorAll('[data-widget="gallery-album"]');for(let e=0;e<n.length;e++)new t.GalleryAlbum(n[e])}(PULSE.app,PULSE.app.common),function(t,e,n){const o="js-thumbnail",a=function(){this.intersectionObserver=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&n.style.addClass(t.target,CONSTANTS.STYLE_CLS_NAMES.IS_VISIBLE)})},{threshold:.6})},i=function(t){const e=this;for(let n=0;n<t.length;n++)e.intersectionObserver.observe(t[n])},l=function(){const e=this;e.filterController&&e.filterController.stopLoading();const n=e.content.querySelectorAll("[data-publish-date]");r.call(e,n),t.common.articleModal&&t.common.articleModal.modal.addThumbListeners(e.content.querySelectorAll(`.${CONSTANTS.JS_CLS_NAMES.ARTICLE_MODAL_EXPAND_THUMB}`)),i.call(e,e.content.querySelectorAll(`.${o}`)),e.contentList.isEmpty()&&e.container.scrollIntoView({behavior:"smooth",block:"start"})},r=function(t){const e=this;for(let o=0;o<t.length;o++){const a=moment(Number(t[o].dataset.publishDate)),i=a.format("DD MMMM YYYY");if(i===e.lastDate)s.call(e,t[o]);else{const l=TEMPLATE_HELPER.render({date:a},"news-feed-container");n.dom.appendDomString(e.content,l),s.call(e,t[o]),e.lastDate=i}t[o].removeAttribute("data-publish-date")}},s=function(t){this.content.querySelector(".js-feed-container:last-of-type").querySelector(".js-feed-items").appendChild(t)},c=function(t){const e=this;e.contentList.listFilter.updateFilters(t),e.contentList.getContentData(!0),e.filterController.startLoading()},d=function(t){const e=this;t.forEach(t=>{t.intersectionRatio>=PRESET_CONFIG.OBSERVER_CONFIG.threshold?e.filterController.show():e.filterController.hide()})};t.ContentFeed=function(e){const r=this;r.container=e,r.content=r.container.querySelector("[data-content-list]"),r.filters=document.querySelector(".js-news-feed-filter"),r.lastDate=r.container.getAttribute("data-last-date"),r.widgetEnd=r.container.querySelector(".js-show-more"),r.hideFilters=n.style.hasClass(r.container,"no-filter"),a.call(r),i.call(r,r.container.querySelectorAll(`.${o}`)),!r.hideFilters&&r.filters&&(r.filters=DOM_HELPER.safeInsertAfterNavigation(r.filters)),r.contentList=new t.ContentList(r.container,{onRenderCallback:l.bind(r)}),r.filters&&(r.observer=new IntersectionObserver(d.bind(r),PRESET_CONFIG.OBSERVER_CONFIG),r.observer.observe(r.container),r.filterController=new t.common.FilterController(r.filters,{dropdowns:t.filterData.filters.news,onFilterUpdate:c.bind(r),preventFetch:!0,parentWidget:r.container,type:t.apiPath.cms.text}))};const u=document.querySelectorAll('[data-widget="content-feed"]');for(let e=0;e<u.length;e++)new t.ContentFeed(u[e])}(PULSE.app,PULSE.app.common,PULSE.core);